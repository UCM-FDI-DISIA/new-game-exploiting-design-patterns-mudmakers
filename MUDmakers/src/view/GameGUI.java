package view;

import server.MudServer;

import javax.swing.*;
import java.awt.*;
import java.awt.event.*;
import java.io.File;

public class GameGUI extends JFrame {

    private JButton startButton;
    private JButton quitButton;

    public GameGUI(File imageFile)
    {
        setLayout(new BorderLayout());
        JLabel background=new JLabel(new ImageIcon(imageFile.getAbsolutePath()));
        add(background);
        background.setLayout(new FlowLayout());
        startButton = new JButton("Start");
        quitButton = new JButton("Quit");
        background.add(startButton);
        background.add(quitButton);

        startButton.addActionListener(new StartButtonListener());
        quitButton.addActionListener(new QuitButtonListener());

        //  finish initializing the window (this is best done last)
        setTitle("Background Image Demo for JFrame");
        pack(); // automatically size the window to fit its components
        setLocationRelativeTo(null); // center this window on the screen
        setDefaultCloseOperation(EXIT_ON_CLOSE); // when this window is closed, exit this application
        // setVisible(true); // call setVisible(true) last of all (best if done by method that created this JFrame
    }

    private class StartButtonListener implements ActionListener {
        public void actionPerformed(ActionEvent e) {
            Thread serverThread = new Thread(() -> {
                MudServer.main(new String[]{});
            });
            serverThread.start();

            try {
                Thread.sleep(2000);
            } catch (InterruptedException ex) {
                ex.printStackTrace();
            }

            MUDFrame frame = new MUDFrame();
            if (!frame.init()) {
                JOptionPane.showMessageDialog(null, "Couldn't connect to server");
                System.exit(1);
            }
        }
    }

    private class QuitButtonListener implements ActionListener {
        public void actionPerformed(ActionEvent e) {
            System.exit(0);
        }
    }

    public static void main(String args[]) {
        SwingUtilities.invokeLater(new Runnable() {
            @Override
            public void run() {
                File imageFile = new File("src/background.jpg");
                if (imageFile != null) {
                    GameGUI frame = new GameGUI(imageFile);
                    frame.setVisible(true);
                }
            }
        });
    }
}